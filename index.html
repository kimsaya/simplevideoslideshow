<html>

<head>
    <title>Water Display</title>

<body>
    <video id="video" autoplay muted controls>
        <source id="source" src="">
        </source>
    </video>
    <script type="text/javascript">
        var url = "http://localhost:8080/"
        var resourcepath = url + "resource/";
        var platlistpath = resourcepath + "playlist.json"
        var end_video = url + "end.mp4"
        var video = document.getElementById('video');
        var sources = document.getElementById('source');
        var playlist = getplaylist();
        var index = 0;

        loadVideo();
        video.onended = function () {
            loadVideo();
        }

        sources.onerror = function () {
            playempty();
        }

        function loadVideo() {
            try {
                playlist = getplaylist();
                if (index >= Object.keys(playlist).length) {
                    index = 0;
                }
                sources.src = resourcepath + playlist[index];
                video.load();
                index++;
            } catch (ex) {
                playempty();
            }
        }

        function playempty() {
            sources.src = end_video;
            video.load();
        }

        function getplaylist() {
            try {
                var json_date = readTextFile(platlistpath);
                return JSON.parse(json_date);
            } catch (ex) {
                playempty();
            }

        }

        function readTextFile(file) {
            var rawFile = new XMLHttpRequest();
            var result;
            rawFile.open("GET", file, false);
            rawFile.onreadystatechange = function () {
                if (rawFile.readyState === 4) {
                    if (rawFile.status === 200 || rawFile.status == 0) {
                        result = rawFile.responseText;
                        // alert(result);
                    }
                }
            }
            rawFile.send(null);
            return result;
        }

        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }
    </script>
</body>
</head>

</html>

<style>
    video {
        width: 100vw;
        height: 100vh;
        object-fit: cover;
        position: absolute;
        top: 0;
        left: 0;
    }
</style>